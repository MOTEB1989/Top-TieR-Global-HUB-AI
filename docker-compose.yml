services:
  core:
    build: ./core
    ports: ["8080:8080"]
    environment:
      RUST_LOG: info
  api:
    build: ./services/api
    ports: ["3000:3000"]
    env_file: .env
    depends_on: [core]
    environment:
      CORE_URL: ${CORE_URL:-http://core:8080}

  db_mysql:
    build: ./adapters/python/db_mysql
    ports: ["5004:5004"]
    environment:
      - MYSQL_URL=mysql://root:password@mysql:3306/lexcode
    depends_on: [mysql]

  mysql:
    image: mysql:8
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: lexcode
    ports: ["3306:3306"]

  db_redis:
    build: ./adapters/python/db_redis
    ports: ["5005:5005"]
    environment:
      - REDIS_URL=redis://redis:6379/0
    depends_on: [redis]

  redis:
    image: redis:7
    restart: always
    ports: ["6379:6379"]

  db_neo4j:
    build: ./adapters/python/db_neo4j
    ports: ["5006:5006"]
    environment:
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASS=password
    depends_on: [neo4j]

  neo4j:
    image: neo4j:5
    restart: always
    environment:
      - NEO4J_AUTH=neo4j/password
    ports: ["7474:7474", "7687:7687"]

  db_clickhouse:
    build: ./adapters/python/db_clickhouse
    ports: ["5007:5007"]
    environment:
      - CLICKHOUSE_HOST=clickhouse
      - CLICKHOUSE_PORT=9000
    depends_on: [clickhouse]

  clickhouse:
    image: clickhouse/clickhouse-server:23
    restart: always
    ports: ["9000:9000", "8123:8123"]
