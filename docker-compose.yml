services:
  core:
    build: ./core
    ports: ["8080:8080"]
    environment:
      RUST_LOG: info
  api:
    build: ./services/api
    ports: ["3000:3000"]
    env_file: .env
    depends_on: [core]
    environment:
      CORE_URL: ${CORE_URL:-http://core:8080}
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./observability/prometheus.yml:/etc/prometheus/prometheus.yml
    ports: ["9090:9090"]
    depends_on: [api]

  grafana:
    image: grafana/grafana:10.4.2
    ports: ["3001:3000"]
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - ./observability/grafana:/var/lib/grafana
    depends_on: [prometheus]

  opensearch:
    image: opensearchproject/opensearch:2.14.0
    environment:
      - discovery.type=single-node
      - plugins.security.disabled=true
    ports:
      - "9200:9200"
      - "9600:9600"
