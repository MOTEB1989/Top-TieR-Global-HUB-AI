name: Comment on PR #264 - Arabic Testing Instructions

on:
  workflow_dispatch:
    inputs:
      force_comment:
        description: 'Force add comment even if one exists'
        required: false
        type: boolean
        default: false

permissions:
  pull-requests: write
  issues: write
  contents: read

jobs:
  add-arabic-testing-comment:
    runs-on: ubuntu-latest
    name: Add Arabic Testing Instructions to PR #264
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Check if comment already exists
        id: check_comment
        if: ${{ !github.event.inputs.force_comment }}
        uses: actions/github-script@v7
        with:
          script: |
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: 264
            });
            
            const existingComment = comments.find(comment => 
              comment.body.includes('ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª')
            );
            
            if (existingComment) {
              core.setOutput('exists', 'true');
              console.log('Arabic testing comment already exists');
            } else {
              core.setOutput('exists', 'false');
              console.log('No existing Arabic testing comment found');
            }
      
      - name: Read comment content from file
        if: ${{ steps.check_comment.outputs.exists == 'false' || github.event.inputs.force_comment }}
        id: read_comment
        run: |
          # Create the comment content
          cat > comment.md << 'EOF'
          # ðŸ§ª ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª - Arabic Testing Instructions

          Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„Ø© Ù„Ù€ PR #264 ðŸŽ¯

          ## Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          Ù‡Ø°Ø§ Ø§Ù„Ù€ PR ÙŠØ¶ÙŠÙ Ù†Ø¸Ø§Ù… ØªÙ†Ø¸ÙŠÙ Ù…ØªØ·ÙˆØ± Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù…Ø¹:
          - **Ø³ÙƒØ±ÙŠÙ¾Øª Python Ù…Ø­Ø³Ù†** Ù„Ø¥ØºÙ„Ø§Ù‚ Issues/PRs  
          - **GitHub Actions Workflow** Ù…Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ©
          - **Ù†Ø¸Ø§Ù… Ø£Ù…Ø§Ù† Ù…ØªÙ‚Ø¯Ù…** Ù…Ø¹ ØªØµÙÙŠØ© Ø°ÙƒÙŠØ©

          ## âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ (5 Ø¯Ù‚Ø§Ø¦Ù‚)

          ### 1. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙƒØ±ÙŠÙ¾Øª Ù…Ø­Ù„ÙŠØ§Ù‹ - Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¢Ù…Ù† âœ…
          ```bash
          # Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
          export GITHUB_TOKEN="your_token_here"
          pip install requests

          # Ø§Ø®ØªØ¨Ø§Ø± Ø£Ø³Ø§Ø³ÙŠ Ø¢Ù…Ù†
          python scripts/close_github_items.py MOTEB1989/Top-TieR-Global-HUB-AI --dry-run --yes

          # Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ ØªØµÙÙŠØ©
          python scripts/close_github_items.py MOTEB1989/Top-TieR-Global-HUB-AI \
            --dry-run --yes --before 2024-01-01 --exclude 264
          ```

          ### 2. Ø§Ø®ØªØ¨Ø§Ø± GitHub Actions Workflow ðŸ”„

          **Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰:** [Actions Tab](https://github.com/MOTEB1989/Top-TieR-Global-HUB-AI/actions)

          **Ø§Ø®ØªØ¨Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:**
          - `ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ (dry-run = Ù„Ø§ ÙŠØºÙ„Ù‚ ÙØ¹Ù„ÙŠØ§Ù‹)` âœ…
          - `ØªØ®Ø·ÙŠ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ Issues` âœ…  
          - `ØªØ®Ø·ÙŠ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ Pull Requests` âœ…
          - `Ø£ØºÙ„Ù‚ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ù‚Ø¯Ù… Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙ‚Ø· (YYYY-MM-DD)` ðŸ“…
          - `Ø£Ø±Ù‚Ø§Ù… Issues/PRs Ù…Ø³ØªØ«Ù†Ø§Ø© (Ù…Ø«Ø§Ù„: 123 456 789)` ðŸ”¢
          - `Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØªØ³Ù…ÙŠØ§Øª` ðŸ·ï¸

          ## ðŸ”— Ù„Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©

          Ø§Ù†Ø¸Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…ÙØµÙ„Ø©:

          ðŸ“„ **`PR264_ARABIC_TESTING_INSTRUCTIONS.md`** - ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø´Ø§Ù…Ù„Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
          ðŸ”§ **`scripts/comment-on-pr264.sh`** - Ø³ÙƒØ±ÙŠÙ¾Øª Ù†Ø´Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
          ðŸ“š **`README_PR264_ARABIC_TESTING.md`** - ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ù‡Ù…Ø©

          ## ðŸš¨ ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ù‡Ù…Ø©

          ### âŒ Ù„Ø§ ØªÙØ¹Ù„:
          - Ø§Ø³ØªØ®Ø¯Ø§Ù… `execute` mode Ø¨Ø¯ÙˆÙ† Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¯Ù‚ÙŠÙ‚Ø©
          - ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠÙ¾Øª Ø¨Ø¯ÙˆÙ† `--exclude` Ù„Ù„Ù€ PRs Ø§Ù„Ù…Ù‡Ù…Ø©
          - Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª production Ù…Ø¨Ø§Ø´Ø±Ø©

          ### âœ… Ø§ÙØ¹Ù„:
          - Ø§Ø¨Ø¯Ø£ Ø¨Ù€ `--dry-run` Ø¯Ø§Ø¦Ù…Ø§Ù‹
          - Ø±Ø§Ø¬Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°
          - Ø§Ø³ØªØ®Ø¯Ù… `--exclude 264` Ù„Ø­Ù…Ø§ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ù€ PR

          ## ðŸ“‹ Ù‚Ø§Ø¦Ù…Ø© ØªØ­Ù‚Ù‚ Ø³Ø±ÙŠØ¹Ø©

          - [ ] Ø§Ù„Ø³ÙƒØ±ÙŠÙ¾Øª ÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¢Ù…Ù† (dry-run) âœ…
          - [ ] Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ØªØ¸Ù‡Ø± ÙÙŠ GitHub Actions âœ…
          - [ ] Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙÙŠØ© ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ âœ…
          - [ ] Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø³Ù„ÙŠÙ…Ø© âœ…
          - [ ] ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ø¶Ø­Ø© âœ…

          ---

          **Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:** Ø§ÙØªØ­ issue Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØªØ³Ù…ÙŠØ© `testing` Ø£Ùˆ `arabic-support`

          **Happy Testing! ðŸŽ‰ / Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙˆÙÙ‚!**
          EOF

      - name: Post Arabic testing instructions comment
        if: ${{ steps.check_comment.outputs.exists == 'false' || github.event.inputs.force_comment }}
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const commentBody = fs.readFileSync('comment.md', 'utf8');

            const response = await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: 264,
              body: commentBody
            });
            
            console.log('âœ… Arabic testing instructions comment posted successfully!');
            console.log(`Comment URL: ${response.data.html_url}`);
            
            core.summary
              .addHeading('ðŸ§ª Arabic Testing Instructions Posted')
              .addRaw('ØªÙ… Ù†Ø´Ø± ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!')
              .addBreak()
              .addLink('View Comment', response.data.html_url)
              .write();
      
      - name: Skip comment (already exists)
        if: ${{ steps.check_comment.outputs.exists == 'true' && !github.event.inputs.force_comment }}
        run: |
          echo "âš ï¸ Arabic testing comment already exists on PR #264"
          echo "Use 'force_comment: true' to add another comment"