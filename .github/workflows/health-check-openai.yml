name: Health Check OpenAI

on:
  schedule:
    - cron: "0 6 * * *"   # â° ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 6 ØµØ¨Ø§Ø­Ø§Ù‹ UTC
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ› ï¸ Checkout Repository
        uses: actions/checkout@v3

      - name: ğŸ“¦ Give script permission
        run: chmod +x verify_repo_link.sh

      - name: âœ… Verify repo link with OpenAI
        id: verify
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: ./verify_repo_link.sh

      - name: ğŸ”” Send alert if verification failed
        if: failure()   # ÙŠØ´ØªØºÙ„ ÙÙ‚Ø· Ù„Ùˆ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙØ´Ù„Øª
        run: |
          echo "âš ï¸ Health Check Failed! Sending alert..."
          # GitHub ÙŠØ±Ø³Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥ÙŠÙ…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙØ´Ù„ Ø§Ù„Ù€ Workflow
          # (ØªØ£ÙƒØ¯ Ø£Ù† Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Actions Ù…ÙØ¹Ù„Ø© Ø¹Ù†Ø¯Ùƒ ÙÙŠ Settings â†’ Notifications)

          # Ù…Ø«Ø§Ù„ Ù„Ø¥Ø±Ø³Ø§Ù„ Webhook (Slack/Discord) Ù„Ùˆ Ø£Ø¶ÙØª secret ALERT_WEBHOOK_URL
          if [ -n "${{ secrets.ALERT_WEBHOOK_URL }}" ]; then
            curl -X POST -H "Content-Type: application/json" \
              -d "{\"content\":\"âš ï¸ Health Check Failed in GitHub Actions! Check verify_repo_link.sh logs.\"}" \
              ${{ secrets.ALERT_WEBHOOK_URL }}
          fi
