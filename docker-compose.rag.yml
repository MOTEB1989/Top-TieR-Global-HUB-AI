version: "3.9"

services:
  qdrant:
    image: qdrant/qdrant:v1.8.4
    restart: unless-stopped
    ports:
      - "6333:6333"
    networks:
      - rag_net

  rag_engine:
    build:
      context: ./services/rag_engine
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      QDRANT_URL: http://qdrant:6333
      GATEWAY_URL: http://gateway:3000
      PHI3_URL: http://phi3:8082
    depends_on:
      - qdrant
    ports:
      - "8081:8081"
    networks:
      - rag_net

  phi3:
    build:
      context: ./services/phi3
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      RAG_ENGINE_URL: http://rag_engine:8081
    depends_on:
      - qdrant
    ports:
      - "8082:8082"
    networks:
      - rag_net

  gateway:
    build:
      context: ./services/gateway
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      LLM_PROVIDER: phi_local
      PHI3_URL: http://phi3:8082
      RAG_ENGINE_URL: http://rag_engine:8081
    depends_on:
      - phi3
      - rag_engine
    ports:
      - "3000:3000"
    networks:
      - rag_net

  web_ui:
    build:
      context: ./services/web_ui
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      RAG_ENGINE_URL: http://rag_engine:8081
      GATEWAY_URL: http://gateway:3000
    depends_on:
      - gateway
    ports:
      - "8501:8501"
    networks:
      - rag_net

networks:
  rag_net:
    driver: bridge
